---
    comments: true
---

# 命题的应用 - 数独游戏

&emsp;&emsp;你说得对，但是数独游戏是一款经典的数字逻辑游戏。玩家需要根据9x9盘面上的已知数字，推算出所有剩余空格的数字，并且满足每一行、每一列、每一个粗线宫内的数字均含1-9，并且不重复。

&emsp;&emsp;数独游戏对逻辑的清晰要求和简单的游戏规定，意味着我们可以将它联系到离散数学中学习到的命题，把逻辑用数学的方式写下来。

## 步骤一 —— 定义命题

&emsp;&emsp;我们规定，$p(i,j,n)$代表把数字n放在i行j列的方格中。容易知道$i$，$j$，$n$的取值总共可以导出$9 \times 9 \times 9 = 729$个命题。

## 步骤二 —— 翻译获胜逻辑

&emsp;&emsp;由于获胜的逻辑需要用到命题的析取、合取等操作，而因为命题过多，我们需要一种简便的表示方法。

* 规定一：多项合取符号
$$
    \bigwedge_{i=x}^y p(i,j_0,n_0) = p(x,j_0,n_0) \land p(x+1,j_0,n_0) \land \cdots \land p(y,j_0,n_0)
$$

* 规定二：多项析取符号
$$
    \bigvee_{i=x}^y p(i,j_1,n_1) = p(x,j_1,n_1) \lor p(x+1,j_1,n_1) \lor \cdots \lor p(y,j_1,n_1)
$$

&emsp;&emsp;根据规定一和规定二，我们可以写出数独游戏胜利的逻辑：

### 1. **每一行都有1-9的所有数字**。
   
&emsp;&emsp;先使用Quantifier可以简单地把“每一行”翻译为$\forall i$，接下来我们需要知道怎么描述“都有1-9的所有数字”。

&emsp;&emsp;我们不妨考虑枚举每一个数字，这样我们就把条件进一步地拓展成为“对于1-9的任意一个数字，这个数字都在这一行”，用数学语言描述即$\forall nP(n)$，$P(n)$表示数字$n$在这一行。

&emsp;&emsp;最后，我们只需要描述怎么表示数字在这一行。数字在这一行，意味着这个数字在这一行的某一列中出现过至少一次，因此，我们把条件拆解为“这个数字在这一行的某一列存在”，即$\exist j \space p(i_0,n_0,j)$。

&emsp;&emsp;于是，我们可以得到这一个逻辑的完整翻译：
 
$$
    \forall i \forall n \exist j \space p(i,j,n) \\
    \equiv \bigwedge_{i=1}^9 \bigwedge_{n=1}^9 \bigvee_{j=1}^9 \space p(i,j,n)
$$

### 2. **每一列都有1-9的所有数字**。
   
&emsp;&emsp;这个逻辑的翻译与上面类似，这里就不再赘述了。
$$
    \forall j \forall n \exist i \space p(i,j,n) \\
    \equiv \bigwedge_{j=1}^9 \bigwedge_{n=1}^9 \bigvee_{i=1}^9 \space p(i,j,n)
$$

### 3. **每一宫格都有1-9的所有数字**。

&emsp;&emsp;首先，宫格这个新概念意味着我们不能单纯地像刚刚的枚举行和列一样，用i和j来表示，因此我们需要引入一个新的变量。

&emsp;&emsp;设想我们需要为这个数独写一个程序，那么一个很容易想到思路的就是先枚举每一个宫格，然后枚举每一个数字，最后判断这个数字在这个宫格中是否出现过。

&emsp;&emsp;如何枚举宫格，一个简单的方法就是直接把九宫格看作一个3x3的矩阵，然后通过行和列的枚举得到宫格。我们假设$x$是九宫格的行，$y$是九宫格的列，那么既然对于某一个九宫格这个条件都成立，那么我们可以把条件写为$\forall x \forall y \space P(x,y)$，其中P(x,y)表示x行y列的宫格都有1-9的所有数字。

&emsp;&emsp;接下来，我们考虑怎么表示x行y列的宫格都有1-9的所有数字。和上面的思路类似，我们首先把条件拆分成“对于1-9的任意一个数字，这个数字都在这一宫格”，即$\forall n \space P(x,y,n)$，$P(x,y,n)$表示x行y列的宫格中数字$n$出现过。

&emsp;&emsp;最后，我们只需要描述怎么表示x行y列的宫格中数字$n$出现过。数字在x行y列的宫格中出现过，意味着这个数字在这一宫格的某一格中出现过至少一次，通过再次枚举行列来计算宫格中一格的位置。用$i$表示宫格的第i行，$j$表示宫格的第j列，那么我们就可以知道宫格中一格相对于宫格左上角坐标为$(i,j)$，总坐标即$(3(x-1)+i,3(y-1)+j)$，n在这些坐标中存在，即可翻译成$\exist i\exist j \space p(3(x-1)+i,3(y-1)+j,n)$。

&emsp;&emsp;于是，我们可以得到这个逻辑的完整翻译：

$$
    \forall x \forall y \forall n\exist i\exist j \space p(3(x-1)+i,3(y-1)+j,n) \\
    \equiv \bigwedge_{x=1}^3 \bigwedge_{y=1}^3 \bigwedge_{n=1}^9 \bigvee_{i=1}^3 \bigvee_{j=1}^3 \space p(3(x-1)+i,3(y-1)+j,n)
$$

&emsp;&emsp;明面上的数独规则就是这么多，但是需要注意的是，因为我们设计的特殊性，会有非常多隐含的条件需要我们考虑，否则就会出很严重的BUG。就比如下面这个规则：

### 4. 每一格只能填一个数字。

&emsp;&emsp;因为我们之前的思路是枚举，所以不免会出现某个格子被重复枚举的情况，比如对于一个格子，我们填入了数字1，然后再填入了数字2，那么数字2就会被重复枚举，因此我们需要进行规定，去除这种情况。

&emsp;&emsp;“每一格”的翻译是非常简单的，即$\forall i \forall j \space P(i,j)$，其中$P(i,j)$表示i行j列的格子只有一个数字。

&emsp;&emsp;那么怎么描述“只有一个数字”呢？这个时候我们通常会想到用逻辑分类来判断，枚举所有的数字，如果填入了数字，那么就不能再填入其他的数字，反之则合法。这个“逻辑分类”的思想恰好和逻辑推出的运算一拍即合，我们可以利用它来完成翻译：
$$
\forall i \forall j (\forall n (p(i,j,n) \rightarrow \neg \exist n' \space p(i,j,n')))  (n'>n) \\\
\begin{aligned}
    &\equiv \forall i \forall j \forall n  (p(i,j,n) \rightarrow \forall n' \neg p(i,j,n'))  (n'>n) \\\
    &\equiv \forall i \forall j \forall n \forall n' (p(i,j,n) \rightarrow  \neg p(i,j,n'))  (n'>n) \\\
    &\equiv \bigwedge_{i=1}^9 \bigwedge_{j=1}^9 \bigwedge_{n=1}^9 \bigwedge_{n'=n+1}^9 (p(i,j,n) \rightarrow \neg p(i,j,n'))
\end{aligned}
$$

## 步骤三 —— 判断获胜情况

&emsp;&emsp;我们既然已经知道了获胜条件，我们就可以从任意一种的$p(i,j,n)$正确性命题的集合判断这种状态是否达到了胜利。从上面获胜条件的判断中，我们知道如果满足了一个条件，那么这个条件最终的计算就会为真，如果四个条件都为真，那么这个状态就达到了胜利。因此我们只需要判断这四个条件是否都为真即可。

&emsp;&emsp;虽然暴力枚举获胜情况需要$2^{729}$次尝试，这非常繁琐，但是至少在现在，我们发现了一个解决数独问题的方法，也从中把它和离散数学的学习联系到了一起。